---
layout: post
title: Ман по работе с KDialog (вторая часть)
category: ConsoleUtilities
---

Итак, в [первой части](https://vk.com/linuxsovet?w=wall-190836544_2684/all) статьи речь шла о вводе и выводе текстовой информации. В этой часть будет описано построение меню (предполагается построение одноуровневых меню, однако можно сделать и многоуровневое, использовав конструкцию ветвления _case_ или _if…fi)_. И такое меню работает куда лучше, чем написанное на обычном Dialog. Чудеса!

### Построение меню.

Меню очень полезно, когда программа выполняет больше одного действия (офигеть, правда?!). И в KDialog это сделано очень удобно.

Итак, для начала нужно объявить какую-то переменную, например, **_menu_** с kdialog:

_menu=$(kdialog --title "Пример классического меню" --menu "Выберите нужный пункт и нажмите [Ok]:" \  
    1 "Пункт 1" \  
    2 "Пункт 2" \  
    3 "Пункт 3")_

(где 1-3 - значения переменной, а то, что в кавычках после значений — описание).

![Ман по работе с KDialog (вторая часть), изображение №1](https://sun9-42.userapi.com/impg/Cz8CgJl0hB1dfYUxERFtiTPgd_S5PAkJDwR9jA/7EQ9q5oaww8.jpg?size=359x188&quality=96&sign=ca0b340db029f7c166f3e78c9f52a9ad&type=album)

Усложним задачу, сделаем так, чтобы в зависимости от выбора открывалось окно KDialog (ключ --msgbox):

menu=$(kdialog --title "Пример классического меню" --menu "Выберите нужный пункт и нажмите [Ok]:" \  
    1 "Пункт 1" \  
    2 "Пункт 2" \  
    3 "Пункт 3")
  
case $menu in  
    1)  
	    kdialog --title "Пункт 1" --msgbox "Был выбран первый пункт"  
    ;;

    2)  
	    kdialog --title "Пункт 2" --msgbox "Был выбран второй пункт"  
    ;;
  
    3)  
	    kdialog --title "Пункт 3" --msgbox "Был выбран третий пункт"  
    ;;
  
    *)  
	    kdialog --title "Ошибка!" --error "Ошибка ввода! Скрипт будет закрыт"  
    ;;  
esac

(для этого будем использовать сам kdialog и конструкцию ветвления case)

0:39

Вот таким простым способом создаётся меню.

Можно ещё добавить всё это в бесконечный цикл, чтобы скрипт не завершался после выбора определённого действия, но это тема для другой статьи. Таже неплохо было бы поговорить об обработчике сигналов с кнопок (закрыть окно, отмена и др.), но это я сделаю позже.

### Создание контрольного списка.

Бывает, что нужно сделать меню, содержащее определённый список действий, подобно настройкам. Для этого служит опция --checklist, всё очень похоже на создание классического меню из предыдущего пункта. Различие — можно выбрать несколько пунктов (как бы поставить галочки), значения переменной будут последовательно записаны или в файл, или в переменную. Если вы делаете что-то типа настроек для своего скрипта, то советую писать значения в файл.

menu=$(kdialog --title "Пример классического меню" --checklist "Выберите нужныe пункт и нажмите [Ok]:" \  
	1 "Пункт 1" ON \  
	2 "Пункт 2" off \  
	3 "Пункт 3" ON )
  
echo $menu > ~/config.conf  
kdialog --title "Ваш конфиг:" --textbox ~/config.conf 600 300

Листайте, там два фото. Это — контрольный список с выбранными «Пункт 1» и «Пункт 3».

Единственное отличие от меню — после описаний добавились «ON» и «off». Они показывают, какой пункт выбран (ON), а какой — нет (off).

Но тут одна загвоздка. Вот вы используете этот скрипт, как настройки к своей программе. Но ведь нужно правильно расставить галочки (на основании конфига, куда они записывались), чтобы не казалось, что настройки сбросились. Я и сам очень долго над этим думал, лепил 100500 огромных ненужных конструкций ветвления, которые только усложняли работу скрипта, замедляли работу, а также эта каша была абсолютно нечитабельной. Поэтому я решил так: пусть идёт проверка до того, как запустится KDialog, grep читает конфиг, если в нём написано «1» , значит значение переменной checklst1=«ON», если нет, то checklst1=«off», и так для каждого пункта в контрольном списке. И вместо ON/off пишу $checklst1. Вот как пример, [настройки](https://github.com/Linuxoid85/helper/blob/master/fl/settings.sh "https://github.com/Linuxoid85/helper/blob/master/fl/settings.sh") Helper. Да, я ещё не завершил переход с Dialog на KDialog, и настройки до сих пор используют Dialog. Однако их синтаксисы очень похожи, поэтому особо непонятного не будет.

### Создание радиолиста.

Если вы используете диалог, то очень полезно было бы использовать радиолист. Эта фича очень похожа на предыдущий контрольный лист, только можно выбрать только один вариант, а не несколько. Синтаксис на 90% совпадает с контрольным листом, поэтому я, пожалуй, опущу исходный код. Единственное — заменить _--checklist_ на _--radiolist._

### Выпадающий список

![Ман по работе с KDialog (вторая часть), изображение №4](https://sun9-15.userapi.com/impg/umw0nGAJaxhMAH86X6f8ahGuR4_jcFK99fQF8A/SvXAFjOfb08.jpg?size=421x132&quality=96&sign=a3e5a9876a5f64c22bc3cb4a1f477b1d&type=album)

Ещё не до конца понял, как осуществляется выбор нужного значения (как в предыдущих пунктах статьи). Но это дело времени.

kdialog --combobox "Выберите свой любимый дистрибутив на основе Debian:" "Сам Debian" "Devuan" "EXE GNU" "LMDE"

## Заключение

Итак, в этой статье я описал построение меню KDialog, описал вроде бы всё, в следующей, третьей части статьи, будеет описание диалога выбора файлов. Напоминаю, что предыдущая статья про ввод и вывод информации [здесь](https://vk.com/@linuxsovet-man-po-rabote-s-kdialog-chast-1-vvod-i-vyvod-informacii "https://vk.com/@linuxsovet-man-po-rabote-s-kdialog-chast-1-vvod-i-vyvod-informacii").